const sampleInput1 =
`...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`;

const realInput =
`.......................................................................................#....................................................
............................#................#..............................................................................................
....#...............................#.............................................................#........#.......#........................
................#.....#...........................#..........#...............................#................................#............#
..........................................#.................................................................................................
..........#............................................#......................#........................................#..............#.....
............................................................................................................................................
..............................#.......................................#............#...............#......#.......#.........................
.................................................................#.........................#................................................
....................#..............#.....#..................................................................................................
..............#............#................................................................................................#.....#......#..
............................................................#...........................#...................................................
..#.........................................#......#......................#.................................................................
...............................................................................................#......................................#.....
............#............................................#.......................................................#..........................
.................#.....................................................................................#....................................
...............................#..................................................#.........#......................................#........
...............................................................#.................................#..........................................
..............#...................................#.......................#................................#........#.......................
.......................................................................................#....................................#..............#
.#........................#...................#................................................................#............................
....................................#......................................................#.........................................#......
...........#......................................................................#................#........................................
....................................................#....................#....................................................#.............
.....................#............................................#......................................#.........#........................
................#...........................................................................................................................
#.........................................#......................................................#................................#.........
............#.......................#........................................#........................#.....................................
......#..................................................................................#................................#.................
...........................................................................................................#........#.......................
.......................................................#.....................................#..............................................
.........#........................#............#...........................#.........#..............................................#.......
.....................................................................................................#......................................
....................#................................................#.........................................................#............
.........................................#.............................................................................#................#...
...........................#....................................#...........................................................................
.......#.......................................................................#.................#........#.......#.........................
......................................................................................#.....................................................
#......................................#..............................#..............................#......................................
.............#......#...........#...........................................................................................................
.....................................................#....................................#...................#..................#..........
..........................#......................................#........................................................#.................
..............................................................................#.............................................................
...................................#............................................................#........#..................................
....#..........#..........................................#..........#....................................................................#.
.................................................................................................................#..........................
...........................#.........................................................#......................................................
.........................................#...................#..............................................................................
........#............................................#........................................#...........#................#................
.............................................#.....................................................#.................#...............#......
............#.................#......#.............................#..........#................................................#............
...........................................................................................................................................#
.........................#.........................#........................................................................................
............................................................#...............................................................................
.........#................................#........................................#.............#.....................................#....
.................#..........#............................................................#......................#...........................
..........................................................................................................#...........#.....................
..........................................................................#..................#............................................#.
......#.........................................................#...........................................................................
....................................................................................................#.....................#.................
...........#......................................#.................#.........#.............................#..................#............
............................#...............................................................................................................
....................#..................................................................#.............................#......................
..........................................#.......................................#.............................#........................#..
#.......#.....#................#.........................#................#..............................#..................................
............................................................................................................................................
.....................................#........................#......................#........#.............................................
.....#......................................#................................#..............................................#.......#.......
............................................................................................................................................
.................#......#........................................#..............................................#......#................#...
................................#.........................................#.................................................................
..........#..........................................................#...........#...............#..........................................
.......................................#.................#................................#..................#..............................
............................................................................................................................................
............................................................................................................................................
.#..................................#............................................................................................#..........
.............#.......#.......................................................#..............................................................
...................................................#.................................#.............#.......#...........................#....
............................................................................................................................................
......#....................#......#............................#....................................................#......#................
...............#..............................#......................#.............................................................#........
........................................#...................................................................................................
.........#..............................................................................................................................#...
.........................#......................................................#.........#..........#......................................
.............................................................#..............................................................#...............
....................................................#....................#..................................................................
#.............#.......................#................................................................................#........#...........
.....#...........................................................#......................................#.....#.............................
..........#.........#........#............................#......................................#..................................#.......
......................................................................................#......................................#..............
...............................................#.....#......................................................................................
................#.........................#....................#.......#.....#...........................................................#..
........................#........................................................................................................#..........
.#...................................#..........................................................#..........#................................
.....................................................................................................................#......................
...........................#..............................................................#.................................................
......#...............#.................................................................................................................#...
....................................................#.....#.............#.....................#.............................................
.......................................#........................................#..................#.............................#..........
............................................................................................................................................
..................#...............#...........#......................................................................................#......
.....................................................................#...............#.....................#..........#.......#.............
..................................................#..............................................#..........................................
..........................#...........#.....................................................................................................
...........................................................................................................................................#
.........................................................#...............#......................................#...........................
........#...........#...........................................#............................................................#..............
..............#.......................................................................#...........................................#.........
....................................................#.......................................................#...............................
................................#..............#........................................................................#...................
.........................................#.......................................................#..........................................
..........................................................#......#...........#...........#............#..............................#......
..........................#........#..............................................................................#...........#.............
...................................................#.......................................................#................................
.........#..............................................................................................................................#...
....................#........#..............................#...............................................................................
......................................................................#.........................#...........................................
......................................................#.......................#..........#...............#..............#...................
...#......................................#.................................................................................................
................#.................................#.........................................................................................
......................#.............#...........................................................................#..........#.........#......
.......#....................................................#............#..................................................................
...................................................................................#........................................................
............................................................................................#......................#........................
...........#...................#.........................#..........................................#......#................................
................#...................................#...........................#.....#.......................................#...........#.
.....................#..................................................#............................................................#......
...............................................................................................#............................................
.#.........................................#.......................#........................................................................
...................................#.........................#..............................................................................
.............................#..............................................................................................................
.................#....................................#....................................#...................#......#.....................
..........................................................................................................................................#.
........#......................................#..................#..........................................................#..............
..............#....................................................................#........................................................
.....................#......................................................................................................................
......................................#...................................................#.................................................
..#...............................................................................................................#.........................
..........................#...................#......#....................#...................#.............................#.....#......#..
......#.........#.................#..............................#..................#...............#........#..............................`;

function parseUniverse(input, emptyDistance) {
  // Initially every tile is 1 unit in size.
  const grid = input.split("\n").map((row) => Array.from(row));
  const yDistances = grid.map(() => 1);
  const xDistances = grid[0].map(() => 1);

  // Find expanded rows+columns
  for (let y = 0; y < grid.length; y++) {
    const row = grid[y];
    if (row.every((x) => x === "."))
      yDistances[y] = emptyDistance;
  }

  for (let x = 0; x < grid[0].length; x++)
    if (grid.every((row) => row[x] === "."))
      xDistances[x] = emptyDistance;

  let galaxies = [];
  for (let y = 0; y < grid.length; y++) {
    const row = grid[y];
    for (let x = 0; x < row.length; x++)
      if (row[x] === "#")
        galaxies.push({ x, y });
  }

  return { galaxies, xDistances, yDistances };
}

function computeDistance(start, end, distances) {
  let s = Math.min(start, end);
  let e = Math.max(start, end);
  let distance = 0;
  while (s < e)
    distance += distances[s++];

  return distance;
}
  
function computeShortestPathLength(start, end, universe) {
  return computeDistance(start.x, end.x, universe.xDistances) + computeDistance(start.y, end.y, universe.yDistances);
}

function solve(input, emptyDistance) {
  const universe = parseUniverse(input, emptyDistance);
  const galaxies = universe.galaxies;
  let totalDistance = 0;
  for (let i = 0; i < galaxies.length; i++) {
    for (let j = i + 1; j < galaxies.length; j++) {
      const distance = computeShortestPathLength(galaxies[i], galaxies[j], universe);
      totalDistance += distance;
//       console.log(`${i+1} => ${j+1} = ${distance}`);
    }
  }

  return totalDistance;
}

// Part 1
console.log(solve(sampleInput1, 2));
console.log(solve(realInput, 2));

// Part 2 example - expand by 10, expect 1030
console.log(solve(sampleInput1, 10));

// Part 2 example - expand by 100, expect 8410
console.log(solve(sampleInput1, 100));

// Part 2
console.log(solve(realInput, 1000000));
